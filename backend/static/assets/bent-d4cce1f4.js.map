{"version":3,"file":"bent-d4cce1f4.js","sources":["../../../frontend/node_modules/bent/src/core.js","../../../frontend/node_modules/bent/src/browser.js"],"sourcesContent":["'use strict'\nconst encodings = new Set(['json', 'buffer', 'string'])\n\nmodule.exports = mkrequest => (...args) => {\n  const statusCodes = new Set()\n  let method\n  let encoding\n  let headers\n  let baseurl = ''\n\n  args.forEach(arg => {\n    if (typeof arg === 'string') {\n      if (arg.toUpperCase() === arg) {\n        if (method) {\n          const msg = `Can't set method to ${arg}, already set to ${method}.`\n          throw new Error(msg)\n        } else {\n          method = arg\n        }\n      } else if (arg.startsWith('http:') || arg.startsWith('https:')) {\n        baseurl = arg\n      } else {\n        if (encodings.has(arg)) {\n          encoding = arg\n        } else {\n          throw new Error(`Unknown encoding, ${arg}`)\n        }\n      }\n    } else if (typeof arg === 'number') {\n      statusCodes.add(arg)\n    } else if (typeof arg === 'object') {\n      if (Array.isArray(arg) || arg instanceof Set) {\n        arg.forEach(code => statusCodes.add(code))\n      } else {\n        if (headers) {\n          throw new Error('Cannot set headers twice.')\n        }\n        headers = arg\n      }\n    } else {\n      throw new Error(`Unknown type: ${typeof arg}`)\n    }\n  })\n\n  if (!method) method = 'GET'\n  if (statusCodes.size === 0) {\n    statusCodes.add(200)\n  }\n\n  return mkrequest(statusCodes, method, encoding, headers, baseurl)\n}\n","'use strict'\n/* global fetch, btoa, Headers */\nconst core = require('./core')\n\nclass StatusError extends Error {\n  constructor (res, ...params) {\n    super(...params)\n\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, StatusError)\n    }\n\n    this.name = 'StatusError'\n    this.message = res.statusMessage\n    this.statusCode = res.status\n    this.res = res\n    this.json = res.json.bind(res)\n    this.text = res.text.bind(res)\n    this.arrayBuffer = res.arrayBuffer.bind(res)\n    let buffer\n    const get = () => {\n      if (!buffer) buffer = this.arrayBuffer()\n      return buffer\n    }\n    Object.defineProperty(this, 'responseBody', { get })\n    // match Node.js headers object\n    this.headers = {}\n    for (const [key, value] of res.headers.entries()) {\n      this.headers[key.toLowerCase()] = value\n    }\n  }\n}\n\nconst mkrequest = (statusCodes, method, encoding, headers, baseurl) => async (_url, body, _headers = {}) => {\n  _url = baseurl + (_url || '')\n  let parsed = new URL(_url)\n\n  if (!headers) headers = {}\n  if (parsed.username) {\n    headers.Authorization = 'Basic ' + btoa(parsed.username + ':' + parsed.password)\n    parsed = new URL(parsed.protocol + '//' + parsed.host + parsed.pathname + parsed.search)\n  }\n  if (parsed.protocol !== 'https:' && parsed.protocol !== 'http:') {\n    throw new Error(`Unknown protocol, ${parsed.protocol}`)\n  }\n\n  if (body) {\n    if (body instanceof ArrayBuffer ||\n      ArrayBuffer.isView(body) ||\n      typeof body === 'string'\n    ) {\n      // noop\n    } else if (typeof body === 'object') {\n      body = JSON.stringify(body)\n      headers['Content-Type'] = 'application/json'\n    } else {\n      throw new Error('Unknown body type.')\n    }\n  }\n\n  _headers = new Headers({ ...(headers || {}), ..._headers })\n\n  const resp = await fetch(parsed, { method, headers: _headers, body })\n  resp.statusCode = resp.status\n\n  if (!statusCodes.has(resp.status)) {\n    throw new StatusError(resp)\n  }\n\n  if (encoding === 'json') return resp.json()\n  else if (encoding === 'buffer') return resp.arrayBuffer()\n  else if (encoding === 'string') return resp.text()\n  else return resp\n}\n\nmodule.exports = core(mkrequest)\n"],"names":["encodings","core","mkrequest","args","statusCodes","method","encoding","headers","baseurl","arg","msg","code","require$$0","StatusError","res","params","buffer","key","value","_url","body","_headers","parsed","resp","browser"],"mappings":"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"}